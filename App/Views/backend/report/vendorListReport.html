{% extends "backend/partition/layout.html" %}

{% block body %}

<style>
	#reportFilter {
		color: white;
		padding: 6px 10px;
		margin-left: 5px;
		background-color: #3c8dbc;
		z-index: 7000;
		border-radius: 5px 5px;
		cursor: pointer;
	}
</style>

<!-- Main Content -->
<div class="page-wrapper">
	<div class="container-fluid">
		<!-- Title -->
		<section class="content-header">
			<h1>Report Table</h1>
			<!-- Breadcrumb -->
			<ol class="breadcrumb">
				<li><a href="/"><i class="fa fa-dashboard"></i> Dashboard</a></li>
				<li class="active">Report Management</li>
			</ol>
			<!-- /Breadcrumb -->
		</section>
		<!-- /Title -->
		{% include "backend/partition/notification.html" %}
		<!-- Row -->
		<section class="content">
			<div class="row">
				<div class="col-sm-12">
					<div class="panel panel-default card-view">
						<div class="panel-heading">
							<div class="pull-left">
								<h6 class="panel-title txt-dark">Report Management</h6>
							</div>
							<!-- <div class="pull-right">
									<a href="/backend/addProduct"><button type="button" class="btn btn-primary btn-md"><i class="fa fa-plus"></i> Add Product</button></a>
								</div> -->
							<div class="clearfix"></div>
						</div>
						<div class="panel-wrapper collapse in">
							<div class="panel-body">
								<div class="table-wrap">
									<div class="table-responsive">
										<input type="hidden" id="vendorId" value="{{vendorId}}">
										<input type="hidden" id="gameType" name="gameType">
										<input type="hidden" id="sessionId" value="{{App.id}}">

										<div class="text-right">
											<label>Start date:</label>
											<input type="date" id="startdate" class="datepicker"></input>
											<label>End date:</label>
											<input type="date" id="enddate" class="datepicker"></input>

											<sapa id="reportFilter"> Get Report</sapa>
										</div>


										<table id="myTable" class="table table-hover display  pb-30">
											<thead>
												<tr>
													<th>Product</th>
													<th>Quantity Sold</th>
													<th>Order Date</th>
													<th>Subtotal</th>
													<!-- <th>Action</th> -->
												</tr>
											</thead>
											<tbody class="newTable">
											</tbody>

											<tfoot>
												<tr>
													<th colspan="3" style="text-align:right">Total:</th>
													<th id="remove_total"></th>
													
												</tr>
											</tfoot>
										</table>


									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>
</div>

{% endblock %}

{% block Jscript %}
<script src="https://cdn.datatables.net/plug-ins/1.12.1/api/sum().js"></script>
<script>

	var host = window.location.origin;

	$(document).ready(function () {
		let vendorId = $("#vendorId").val();

		let sessionId = $("#sessionId").val();
		var myDataTable = $('#myTable').DataTable({
			// "oLanguage": {
			// 	"sSearch": "Search Username"
			// },
			// "scrollX": true,
			"processing": true,
			"serverSide": true,
			"searching": false,
			"ordering": false,
			"autoWidth": false,
			"pageLength": 25,


			"ajax": host + "/backend/getReportList/" + vendorId,

			"columns": [
				{ "data": "productName" },
				// { "data": "product_description" },


				{ "data": "product_quantity" },
				{ "data": "orderDate" },



				{
					"data": "withTax_amount",

					render: function (data, type, row) {


						return '<span>&#8377;</span>' + row.withTax_amount + ''

						// return   row.withTax_amount 


					}

				},

			],

			footerCallback: function (row, data, start, end, display) {
            var api = this.api();
 
            // Remove the formatting to get integer data for summation
            var intVal = function (i) {
                return typeof i === 'string' ? i.replace(/[\$,]/g, '') * 1 : typeof i === 'number' ? i : 0;
            };
 
            // Total over all pages
            total = api
                .column(3)
                .data()
                .reduce(function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0);
 
            // Total over this page
            pageTotal = api
                .column(3, { page: 'current' })
                .data()
                .reduce(function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0);
 
            // Update footer
            $(api.column(3).footer()).html('<span>&#8377;</span>' + pageTotal );
        },

		});


		$(function () {
			"use strict";

			var SweetAlert = function () { };

			SweetAlert.prototype.init = function () {

				//Parameter
				$('body').on('click', '.delete', function (e) {
					var id = $(this).attr('id');
					var thisElement = this;
					swal({
						title: "Are you sure?",
						text: "You will not be able to recover this Project!",
						type: "warning",
						showCancelButton: true,
						confirmButtonColor: "#e69a2a",
						confirmButtonText: "Yes, delete it!",
						cancelButtonText: "No, cancel plx!",
						closeOnConfirm: false,
						closeOnCancel: false
					}, function (isConfirm) {
						if (isConfirm) {
							$.ajax({
								type: 'POST',
								url: host + "/backend/OrderDelete",
								data: { id: id },
								success: function (resultData) {
									// alert(resultData)
									console.log(resultData);
									if (resultData == 'success') {
										$(thisElement).parent().parent().hide(700);
										swal("Deleted!", "Your imaginary file has been deleted.", "success");
									} else {
										alert("Something went wrong")
									}
									// alert("Save Complete")
								}
							});
							swal("Deleted!", "Order Deleted Succesfully.", "success");
						} else {
							swal("Cancelled", "Order Not Deleted)", "error");
						}
					});
					return false;
				});

			},
				$.SweetAlert = new SweetAlert, $.SweetAlert.Constructor = SweetAlert;

			$.SweetAlert.init();
		});


		// var seen = {};
		// $(' tbody.newTable').each(function () {
		// 	var txt = $(this).find("td");

		// 	console.log("texrt tetret  ===>>> ",txt);

		// 	if (seen[txt])
		// 		$(this).remove();
		// 	else
		// 		seen[txt] = true;
		// });



	});


	$(document).on('click', '#reportFilter', function () {

		$("#remove_total").attr('text','');
		let vendorId = $("#vendorId").val();

		let startDate = $("#startdate").val();
		let endDate = $("#enddate").val();

		var myDataTable = $('#myTable').DataTable({
			// "oLanguage": {
			// 	"sSearch": "Search Username"
			// },
			// "scrollX": true,
			"processing": true,
			"serverSide": true,
			"searching": false,
			"ordering": false,
			"autoWidth": false,
			"pageLength": 25,
			destroy: true,


			"ajax": host + "/backend/getReportList/" + startDate + '/' + endDate + '/' + vendorId,

			"columns": [
				{ "data": "productName" },
				// { "data": "product_description" },


				{ "data": "product_quantity" },
				{ "data": "orderDate" },


				{
					"data": "withTax_amount",

					render: function (data, type, row) {


						return '<span>&#8377;</span>' + row.withTax_amount + ''

					}

				},

			],
			footerCallback: function (row, data, start, end, display) {
            var api = this.api();
 
            // Remove the formatting to get integer data for summation
            var intVal = function (i) {
                return typeof i === 'string' ? i.replace(/[\$,]/g, '') * 1 : typeof i === 'number' ? i : 0;
            };
 
            // Total over all pages
            total = api
                .column(3)
                .data()
                .reduce(function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0);
 
            // Total over this page
            pageTotal = api
                .column(3, { page: 'current' })
                .data()
                .reduce(function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0);
 
            // Update footer
            // $(api.column(3).footer()).html('');
            $(api.column(3).footer()).html('<span>&#8377;</span>' + pageTotal );
        },

		});




	});




</script>
{% endblock %}